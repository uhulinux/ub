diff -Naur grub-0.97.orig/config.h.in grub-0.97/config.h.in
--- grub-0.97.orig/config.h.in	2005-05-08 04:48:19.000000000 +0200
+++ grub-0.97/config.h.in	2007-08-14 18:46:53.000000000 +0200
@@ -27,9 +27,16 @@
 /* Define to 1 if you have the <inttypes.h> header file. */
 #undef HAVE_INTTYPES_H
 
+/* Define to 1 if you have the `aal-minimal' library (-laal-minimal). */
+#undef HAVE_LIBAAL_MINIMAL
+
 /* Define if you have a curses library */
 #undef HAVE_LIBCURSES
 
+/* Define to 1 if you have the `reiser4-minimal' library (-lreiser4-minimal).
+   */
+#undef HAVE_LIBREISER4_MINIMAL
+
 /* Define to 1 if you have the <memory.h> header file. */
 #undef HAVE_MEMORY_H
 
diff -Naur grub-0.97.orig/configure grub-0.97/configure
--- grub-0.97.orig/configure	2005-05-08 04:48:12.000000000 +0200
+++ grub-0.97/configure	2007-08-14 18:47:00.000000000 +0200
@@ -311,7 +311,7 @@
 # include <unistd.h>
 #endif"
 
-ac_subst_vars='SHELL PATH_SEPARATOR PACKAGE_NAME PACKAGE_TARNAME PACKAGE_VERSION PACKAGE_STRING PACKAGE_BUGREPORT exec_prefix prefix program_transform_name bindir sbindir libexecdir datadir sysconfdir sharedstatedir localstatedir libdir includedir oldincludedir infodir mandir build_alias host_alias target_alias DEFS ECHO_C ECHO_N ECHO_T LIBS INSTALL_PROGRAM INSTALL_SCRIPT INSTALL_DATA CYGPATH_W PACKAGE VERSION ACLOCAL AUTOCONF AUTOMAKE AUTOHEADER MAKEINFO install_sh STRIP ac_ct_STRIP INSTALL_STRIP_PROGRAM mkdir_p AWK SET_MAKE am__leading_dot AMTAR am__tar am__untar build build_cpu build_vendor build_os host host_cpu host_vendor host_os MAINTAINER_MODE_TRUE MAINTAINER_MODE_FALSE MAINT PERL CC ac_ct_CC CFLAGS LDFLAGS CPPFLAGS EXEEXT OBJEXT DEPDIR am__include am__quote AMDEP_TRUE AMDEP_FALSE AMDEPBACKSLASH CCDEPMODE am__fastdepCC_TRUE am__fastdepCC_FALSE CCAS RANLIB ac_ct_RANLIB STAGE1_CFLAGS STAGE2_CFLAGS GRUB_CFLAGS OBJCOPY ac_ct_OBJCOPY GRUB_LIBS CPP EGREP NETBOOT_SUPPORT_TRUE NETBOOT_SUPPORT_FALSE DISKLESS_SUPPORT_TRUE DISKLESS_SUPPORT_FALSE HERCULES_SUPPORT_TRUE HERCULES_SUPPORT_FALSE SERIAL_SUPPORT_TRUE SERIAL_SUPPORT_FALSE SERIAL_SPEED_SIMULATION_TRUE SERIAL_SPEED_SIMULATION_FALSE BUILD_EXAMPLE_KERNEL_TRUE BUILD_EXAMPLE_KERNEL_FALSE FSYS_CFLAGS NET_CFLAGS NET_EXTRAFLAGS NETBOOT_DRIVERS CCASFLAGS LIBOBJS LTLIBOBJS'
+ac_subst_vars='SHELL PATH_SEPARATOR PACKAGE_NAME PACKAGE_TARNAME PACKAGE_VERSION PACKAGE_STRING PACKAGE_BUGREPORT exec_prefix prefix program_transform_name bindir sbindir libexecdir datadir sysconfdir sharedstatedir localstatedir libdir includedir oldincludedir infodir mandir build_alias host_alias target_alias DEFS ECHO_C ECHO_N ECHO_T LIBS INSTALL_PROGRAM INSTALL_SCRIPT INSTALL_DATA CYGPATH_W PACKAGE VERSION ACLOCAL AUTOCONF AUTOMAKE AUTOHEADER MAKEINFO install_sh STRIP ac_ct_STRIP INSTALL_STRIP_PROGRAM mkdir_p AWK SET_MAKE am__leading_dot AMTAR am__tar am__untar build build_cpu build_vendor build_os host host_cpu host_vendor host_os MAINTAINER_MODE_TRUE MAINTAINER_MODE_FALSE MAINT PERL CC ac_ct_CC CFLAGS LDFLAGS CPPFLAGS EXEEXT OBJEXT DEPDIR am__include am__quote AMDEP_TRUE AMDEP_FALSE AMDEPBACKSLASH CCDEPMODE am__fastdepCC_TRUE am__fastdepCC_FALSE CCAS RANLIB ac_ct_RANLIB STAGE1_CFLAGS STAGE2_CFLAGS GRUB_CFLAGS OBJCOPY ac_ct_OBJCOPY GRUB_LIBS CPP EGREP REISER4_LIBS REISER4_CFLAGS ENABLE_REISER4_SUPPORT_TRUE ENABLE_REISER4_SUPPORT_FALSE NETBOOT_SUPPORT_TRUE NETBOOT_SUPPORT_FALSE DISKLESS_SUPPORT_TRUE DISKLESS_SUPPORT_FALSE HERCULES_SUPPORT_TRUE HERCULES_SUPPORT_FALSE SERIAL_SUPPORT_TRUE SERIAL_SUPPORT_FALSE SERIAL_SPEED_SIMULATION_TRUE SERIAL_SPEED_SIMULATION_FALSE BUILD_EXAMPLE_KERNEL_TRUE BUILD_EXAMPLE_KERNEL_FALSE FSYS_CFLAGS NET_CFLAGS NET_EXTRAFLAGS NETBOOT_DRIVERS CCASFLAGS LIBOBJS LTLIBOBJS'
 ac_subst_files=''
 
 # Initialize some variables set by options.
@@ -863,6 +863,7 @@
   --disable-ufs2          disable UFS2 support in Stage 2
   --disable-minix         disable Minix fs support in Stage 2
   --disable-reiserfs      disable ReiserFS support in Stage 2
+  --disable-reiser4       disable Reiser4 support in Stage 2
   --disable-vstafs        disable VSTa FS support in Stage 2
   --disable-jfs           disable IBM JFS support in Stage 2
   --disable-xfs           disable SGI XFS support in Stage 2
@@ -5493,6 +5494,589 @@
   FSYS_CFLAGS="$FSYS_CFLAGS -DFSYS_REISERFS=1"
 fi
 
+REISER4_LIBS=""
+REISER4_CFLAGS=""
+
+OLD_LIBS=$LIBS
+OLD_CFLAGS=$CFLAGS
+LIBS=""
+CFLAGS=""
+
+# Check whether --enable-reiser4 or --disable-reiser4 was given.
+if test "${enable_reiser4+set}" = set; then
+  enableval="$enable_reiser4"
+
+fi;
+
+if test x"$enable_reiser4" != xno; then
+
+echo "$as_me:$LINENO: checking for aal_mem_init in -laal-minimal" >&5
+echo $ECHO_N "checking for aal_mem_init in -laal-minimal... $ECHO_C" >&6
+if test "${ac_cv_lib_aal_minimal_aal_mem_init+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-laal-minimal  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char aal_mem_init ();
+int
+main ()
+{
+aal_mem_init ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_c_werror_flag"
+			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_cv_lib_aal_minimal_aal_mem_init=yes
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+ac_cv_lib_aal_minimal_aal_mem_init=no
+fi
+rm -f conftest.err conftest.$ac_objext \
+      conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: $ac_cv_lib_aal_minimal_aal_mem_init" >&5
+echo "${ECHO_T}$ac_cv_lib_aal_minimal_aal_mem_init" >&6
+if test $ac_cv_lib_aal_minimal_aal_mem_init = yes; then
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LIBAAL_MINIMAL 1
+_ACEOF
+
+  LIBS="-laal-minimal $LIBS"
+
+else
+  { echo "$as_me:$LINENO: WARNING: Reiser4 support is disabled due to inability find libaal-minimal with
+memory manager support turned on." >&5
+echo "$as_me: WARNING: Reiser4 support is disabled due to inability find libaal-minimal with
+memory manager support turned on." >&2;}
+    enable_reiser4=no
+
+fi
+
+fi
+
+if test x"$enable_reiser4" != xno; then
+  if test "${ac_cv_header_aal_libaal_h+set}" = set; then
+  echo "$as_me:$LINENO: checking for aal/libaal.h" >&5
+echo $ECHO_N "checking for aal/libaal.h... $ECHO_C" >&6
+if test "${ac_cv_header_aal_libaal_h+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: $ac_cv_header_aal_libaal_h" >&5
+echo "${ECHO_T}$ac_cv_header_aal_libaal_h" >&6
+else
+  # Is the header compilable?
+echo "$as_me:$LINENO: checking aal/libaal.h usability" >&5
+echo $ECHO_N "checking aal/libaal.h usability... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+$ac_includes_default
+#include <aal/libaal.h>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_c_werror_flag"
+			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+ac_header_compiler=no
+fi
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+echo "${ECHO_T}$ac_header_compiler" >&6
+
+# Is the header present?
+echo "$as_me:$LINENO: checking aal/libaal.h presence" >&5
+echo $ECHO_N "checking aal/libaal.h presence... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+#include <aal/libaal.h>
+_ACEOF
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+    ac_cpp_err=$ac_cpp_err$ac_c_werror_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
+  yes:no: )
+    { echo "$as_me:$LINENO: WARNING: aal/libaal.h: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: aal/libaal.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: aal/libaal.h: proceeding with the compiler's result" >&5
+echo "$as_me: WARNING: aal/libaal.h: proceeding with the compiler's result" >&2;}
+    ac_header_preproc=yes
+    ;;
+  no:yes:* )
+    { echo "$as_me:$LINENO: WARNING: aal/libaal.h: present but cannot be compiled" >&5
+echo "$as_me: WARNING: aal/libaal.h: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: aal/libaal.h:     check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: aal/libaal.h:     check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: aal/libaal.h: see the Autoconf documentation" >&5
+echo "$as_me: WARNING: aal/libaal.h: see the Autoconf documentation" >&2;}
+    { echo "$as_me:$LINENO: WARNING: aal/libaal.h:     section \"Present But Cannot Be Compiled\"" >&5
+echo "$as_me: WARNING: aal/libaal.h:     section \"Present But Cannot Be Compiled\"" >&2;}
+    { echo "$as_me:$LINENO: WARNING: aal/libaal.h: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: aal/libaal.h: proceeding with the preprocessor's result" >&2;}
+    { echo "$as_me:$LINENO: WARNING: aal/libaal.h: in the future, the compiler will take precedence" >&5
+echo "$as_me: WARNING: aal/libaal.h: in the future, the compiler will take precedence" >&2;}
+    (
+      cat <<\_ASBOX
+## ------------------------------- ##
+## Report this to bug-grub@gnu.org ##
+## ------------------------------- ##
+_ASBOX
+    ) |
+      sed "s/^/$as_me: WARNING:     /" >&2
+    ;;
+esac
+echo "$as_me:$LINENO: checking for aal/libaal.h" >&5
+echo $ECHO_N "checking for aal/libaal.h... $ECHO_C" >&6
+if test "${ac_cv_header_aal_libaal_h+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_cv_header_aal_libaal_h=$ac_header_preproc
+fi
+echo "$as_me:$LINENO: result: $ac_cv_header_aal_libaal_h" >&5
+echo "${ECHO_T}$ac_cv_header_aal_libaal_h" >&6
+
+fi
+if test $ac_cv_header_aal_libaal_h = yes; then
+  :
+else
+  { echo "$as_me:$LINENO: WARNING: Libaal header files are not found. Reiser4 support is disabled
+  " >&5
+echo "$as_me: WARNING: Libaal header files are not found. Reiser4 support is disabled
+  " >&2;}
+  enable_reiser4=no
+fi
+
+
+fi
+
+if test x"$enable_reiser4" != xno; then
+
+echo "$as_me:$LINENO: checking for reiser4_fs_open in -lreiser4-minimal" >&5
+echo $ECHO_N "checking for reiser4_fs_open in -lreiser4-minimal... $ECHO_C" >&6
+if test "${ac_cv_lib_reiser4_minimal_reiser4_fs_open+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lreiser4-minimal -laal-minimal
+   $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char reiser4_fs_open ();
+int
+main ()
+{
+reiser4_fs_open ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_c_werror_flag"
+			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_cv_lib_reiser4_minimal_reiser4_fs_open=yes
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+ac_cv_lib_reiser4_minimal_reiser4_fs_open=no
+fi
+rm -f conftest.err conftest.$ac_objext \
+      conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: $ac_cv_lib_reiser4_minimal_reiser4_fs_open" >&5
+echo "${ECHO_T}$ac_cv_lib_reiser4_minimal_reiser4_fs_open" >&6
+if test $ac_cv_lib_reiser4_minimal_reiser4_fs_open = yes; then
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LIBREISER4_MINIMAL 1
+_ACEOF
+
+  LIBS="-lreiser4-minimal $LIBS"
+
+else
+  { echo "$as_me:$LINENO: WARNING: Reiser4 support is disabled due to inability find valid libreiser4-minimal." >&5
+echo "$as_me: WARNING: Reiser4 support is disabled due to inability find valid libreiser4-minimal." >&2;}
+    enable_reiser4=no
+fi
+
+fi
+
+if test x"$enable_reiser4" != xno; then
+  if test "${ac_cv_header_reiser4_libreiser4_h+set}" = set; then
+  echo "$as_me:$LINENO: checking for reiser4/libreiser4.h" >&5
+echo $ECHO_N "checking for reiser4/libreiser4.h... $ECHO_C" >&6
+if test "${ac_cv_header_reiser4_libreiser4_h+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: $ac_cv_header_reiser4_libreiser4_h" >&5
+echo "${ECHO_T}$ac_cv_header_reiser4_libreiser4_h" >&6
+else
+  # Is the header compilable?
+echo "$as_me:$LINENO: checking reiser4/libreiser4.h usability" >&5
+echo $ECHO_N "checking reiser4/libreiser4.h usability... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+$ac_includes_default
+#include <reiser4/libreiser4.h>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_c_werror_flag"
+			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+ac_header_compiler=no
+fi
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+echo "${ECHO_T}$ac_header_compiler" >&6
+
+# Is the header present?
+echo "$as_me:$LINENO: checking reiser4/libreiser4.h presence" >&5
+echo $ECHO_N "checking reiser4/libreiser4.h presence... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+#include <reiser4/libreiser4.h>
+_ACEOF
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+    ac_cpp_err=$ac_cpp_err$ac_c_werror_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
+  yes:no: )
+    { echo "$as_me:$LINENO: WARNING: reiser4/libreiser4.h: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: reiser4/libreiser4.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: reiser4/libreiser4.h: proceeding with the compiler's result" >&5
+echo "$as_me: WARNING: reiser4/libreiser4.h: proceeding with the compiler's result" >&2;}
+    ac_header_preproc=yes
+    ;;
+  no:yes:* )
+    { echo "$as_me:$LINENO: WARNING: reiser4/libreiser4.h: present but cannot be compiled" >&5
+echo "$as_me: WARNING: reiser4/libreiser4.h: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: reiser4/libreiser4.h:     check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: reiser4/libreiser4.h:     check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: reiser4/libreiser4.h: see the Autoconf documentation" >&5
+echo "$as_me: WARNING: reiser4/libreiser4.h: see the Autoconf documentation" >&2;}
+    { echo "$as_me:$LINENO: WARNING: reiser4/libreiser4.h:     section \"Present But Cannot Be Compiled\"" >&5
+echo "$as_me: WARNING: reiser4/libreiser4.h:     section \"Present But Cannot Be Compiled\"" >&2;}
+    { echo "$as_me:$LINENO: WARNING: reiser4/libreiser4.h: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: reiser4/libreiser4.h: proceeding with the preprocessor's result" >&2;}
+    { echo "$as_me:$LINENO: WARNING: reiser4/libreiser4.h: in the future, the compiler will take precedence" >&5
+echo "$as_me: WARNING: reiser4/libreiser4.h: in the future, the compiler will take precedence" >&2;}
+    (
+      cat <<\_ASBOX
+## ------------------------------- ##
+## Report this to bug-grub@gnu.org ##
+## ------------------------------- ##
+_ASBOX
+    ) |
+      sed "s/^/$as_me: WARNING:     /" >&2
+    ;;
+esac
+echo "$as_me:$LINENO: checking for reiser4/libreiser4.h" >&5
+echo $ECHO_N "checking for reiser4/libreiser4.h... $ECHO_C" >&6
+if test "${ac_cv_header_reiser4_libreiser4_h+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_cv_header_reiser4_libreiser4_h=$ac_header_preproc
+fi
+echo "$as_me:$LINENO: result: $ac_cv_header_reiser4_libreiser4_h" >&5
+echo "${ECHO_T}$ac_cv_header_reiser4_libreiser4_h" >&6
+
+fi
+if test $ac_cv_header_reiser4_libreiser4_h = yes; then
+  :
+else
+  { echo "$as_me:$LINENO: WARNING: Reiser4 header files are not found. Reiser4 support is disabled.
+  " >&5
+echo "$as_me: WARNING: Reiser4 header files are not found. Reiser4 support is disabled.
+  " >&2;}
+  enable_reiser4=no
+fi
+
+
+fi
+
+if test x"$enable_reiser4" != xno; then
+  REISER4_CFLAGS="$REISER4_CFLAGS -DFSYS_REISER4=1"
+  REISER4_LIBS=$LIBS
+fi
+
+if test x"$enable_reiser4" != xno; then
+  echo "$as_me:$LINENO: checking for __sym40_plug_init in -lreiser4-minimal" >&5
+echo $ECHO_N "checking for __sym40_plug_init in -lreiser4-minimal... $ECHO_C" >&6
+if test "${ac_cv_lib_reiser4_minimal___sym40_plug_init+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lreiser4-minimal -laal-minimal
+   $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char __sym40_plug_init ();
+int
+main ()
+{
+__sym40_plug_init ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_c_werror_flag"
+			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_cv_lib_reiser4_minimal___sym40_plug_init=yes
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+ac_cv_lib_reiser4_minimal___sym40_plug_init=no
+fi
+rm -f conftest.err conftest.$ac_objext \
+      conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: $ac_cv_lib_reiser4_minimal___sym40_plug_init" >&5
+echo "${ECHO_T}$ac_cv_lib_reiser4_minimal___sym40_plug_init" >&6
+if test $ac_cv_lib_reiser4_minimal___sym40_plug_init = yes; then
+  REISER4_CFLAGS="$REISER4_CFLAGS -DENABLE_SYMLINKS=1"
+else
+  { echo "$as_me:$LINENO: WARNING: Reiser4 symlinks support is disabled." >&5
+echo "$as_me: WARNING: Reiser4 symlinks support is disabled." >&2;}
+fi
+
+fi
+
+LIBS=$OLD_LIBS
+CFLAGS=$OLD_CFLAGS
+
+if test x"$enable_reiser4" != xno; then
+  enable_reiser4_support=yes
+  FSYS_CFLAGS="$FSYS_CFLAGS $REISER4_CFLAGS"
+fi
+
+
+
+
+
+if test x"$enable_reiser4" != xno; then
+  ENABLE_REISER4_SUPPORT_TRUE=
+  ENABLE_REISER4_SUPPORT_FALSE='#'
+else
+  ENABLE_REISER4_SUPPORT_TRUE='#'
+  ENABLE_REISER4_SUPPORT_FALSE=
+fi
+
+
 # Check whether --enable-vstafs or --disable-vstafs was given.
 if test "${enable_vstafs+set}" = set; then
   enableval="$enable_vstafs"
@@ -6256,6 +6840,13 @@
 Usually this means the macro was only invoked conditionally." >&2;}
    { (exit 1); exit 1; }; }
 fi
+if test -z "${ENABLE_REISER4_SUPPORT_TRUE}" && test -z "${ENABLE_REISER4_SUPPORT_FALSE}"; then
+  { { echo "$as_me:$LINENO: error: conditional \"ENABLE_REISER4_SUPPORT\" was never defined.
+Usually this means the macro was only invoked conditionally." >&5
+echo "$as_me: error: conditional \"ENABLE_REISER4_SUPPORT\" was never defined.
+Usually this means the macro was only invoked conditionally." >&2;}
+   { (exit 1); exit 1; }; }
+fi
 if test -z "${NETBOOT_SUPPORT_TRUE}" && test -z "${NETBOOT_SUPPORT_FALSE}"; then
   { { echo "$as_me:$LINENO: error: conditional \"NETBOOT_SUPPORT\" was never defined.
 Usually this means the macro was only invoked conditionally." >&5
@@ -6903,6 +7494,10 @@
 s,@GRUB_LIBS@,$GRUB_LIBS,;t t
 s,@CPP@,$CPP,;t t
 s,@EGREP@,$EGREP,;t t
+s,@REISER4_LIBS@,$REISER4_LIBS,;t t
+s,@REISER4_CFLAGS@,$REISER4_CFLAGS,;t t
+s,@ENABLE_REISER4_SUPPORT_TRUE@,$ENABLE_REISER4_SUPPORT_TRUE,;t t
+s,@ENABLE_REISER4_SUPPORT_FALSE@,$ENABLE_REISER4_SUPPORT_FALSE,;t t
 s,@NETBOOT_SUPPORT_TRUE@,$NETBOOT_SUPPORT_TRUE,;t t
 s,@NETBOOT_SUPPORT_FALSE@,$NETBOOT_SUPPORT_FALSE,;t t
 s,@DISKLESS_SUPPORT_TRUE@,$DISKLESS_SUPPORT_TRUE,;t t
diff -Naur grub-0.97.orig/docs/grub.texi grub-0.97/docs/grub.texi
--- grub-0.97.orig/docs/grub.texi	2005-05-08 04:59:59.000000000 +0200
+++ grub-0.97/docs/grub.texi	2007-08-14 18:46:53.000000000 +0200
@@ -283,7 +283,7 @@
 Support multiple filesystem types transparently, plus a useful explicit
 blocklist notation. The currently supported filesystem types are
 @dfn{BSD FFS}, @dfn{DOS FAT16 and FAT32}, @dfn{Minix fs}, @dfn{Linux
-ext2fs}, @dfn{ReiserFS}, @dfn{JFS}, @dfn{XFS}, and @dfn{VSTa
+ext2fs}, @dfn{ReiserFS}, @dfn{ReiserFS}, @dfn{JFS}, @dfn{XFS}, and @dfn{VSTa
 fs}. @xref{Filesystem}, for more information.
 
 @item Support automatic decompression
@@ -1776,6 +1776,7 @@
 @itemx jfs_stage1_5
 @itemx minix_stage1_5
 @itemx reiserfs_stage1_5
+@itemx reiser4_stage1_5
 @itemx vstafs_stage1_5
 @itemx xfs_stage1_5
 
diff -Naur grub-0.97.orig/grub/Makefile.in grub-0.97/grub/Makefile.in
--- grub-0.97.orig/grub/Makefile.in	2005-05-08 04:42:34.000000000 +0200
+++ grub-0.97/grub/Makefile.in	2007-08-14 18:47:02.000000000 +0200
@@ -56,7 +56,7 @@
 grub_OBJECTS = $(am_grub_OBJECTS)
 am__DEPENDENCIES_1 =
 grub_DEPENDENCIES = ../stage2/libgrub.a ../lib/libcommon.a \
-	$(am__DEPENDENCIES_1)
+	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1)
 DEFAULT_INCLUDES = -I. -I$(srcdir) -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -95,6 +95,8 @@
 ECHO_N = @ECHO_N@
 ECHO_T = @ECHO_T@
 EGREP = @EGREP@
+ENABLE_REISER4_SUPPORT_FALSE = @ENABLE_REISER4_SUPPORT_FALSE@
+ENABLE_REISER4_SUPPORT_TRUE = @ENABLE_REISER4_SUPPORT_TRUE@
 EXEEXT = @EXEEXT@
 FSYS_CFLAGS = @FSYS_CFLAGS@
 GRUB_CFLAGS = @GRUB_CFLAGS@
@@ -129,6 +131,8 @@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
 RANLIB = @RANLIB@
+REISER4_CFLAGS = @REISER4_CFLAGS@
+REISER4_LIBS = @REISER4_LIBS@
 SERIAL_SPEED_SIMULATION_FALSE = @SERIAL_SPEED_SIMULATION_FALSE@
 SERIAL_SPEED_SIMULATION_TRUE = @SERIAL_SPEED_SIMULATION_TRUE@
 SERIAL_SUPPORT_FALSE = @SERIAL_SUPPORT_FALSE@
@@ -189,7 +193,7 @@
 
 AM_CFLAGS = $(GRUB_CFLAGS)
 grub_SOURCES = main.c asmstub.c
-grub_LDADD = ../stage2/libgrub.a  ../lib/libcommon.a $(GRUB_LIBS)
+grub_LDADD = ../stage2/libgrub.a  ../lib/libcommon.a $(GRUB_LIBS) $(REISER4_LIBS)
 all: all-am
 
 .SUFFIXES:
diff -Naur grub-0.97.orig/INSTALL grub-0.97/INSTALL
--- grub-0.97.orig/INSTALL	2005-05-08 04:43:15.000000000 +0200
+++ grub-0.97/INSTALL	2007-08-14 18:46:53.000000000 +0200
@@ -207,6 +207,9 @@
 `--disable-reiserfs'
      Omit the ReiserFS support in Stage 2.
 
+`--disable-reiser4'
+     Omit the Reiser4 support in Stage 2.
+
 `--disable-vstafs'
      Omit the VSTa filesystem support in Stage 2.
 
diff -Naur grub-0.97.orig/Makefile.in grub-0.97/Makefile.in
--- grub-0.97.orig/Makefile.in	2005-05-08 04:42:40.000000000 +0200
+++ grub-0.97/Makefile.in	2007-08-14 18:47:06.000000000 +0200
@@ -99,6 +99,8 @@
 ECHO_N = @ECHO_N@
 ECHO_T = @ECHO_T@
 EGREP = @EGREP@
+ENABLE_REISER4_SUPPORT_FALSE = @ENABLE_REISER4_SUPPORT_FALSE@
+ENABLE_REISER4_SUPPORT_TRUE = @ENABLE_REISER4_SUPPORT_TRUE@
 EXEEXT = @EXEEXT@
 FSYS_CFLAGS = @FSYS_CFLAGS@
 GRUB_CFLAGS = @GRUB_CFLAGS@
@@ -133,6 +135,8 @@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
 RANLIB = @RANLIB@
+REISER4_CFLAGS = @REISER4_CFLAGS@
+REISER4_LIBS = @REISER4_LIBS@
 SERIAL_SPEED_SIMULATION_FALSE = @SERIAL_SPEED_SIMULATION_FALSE@
 SERIAL_SPEED_SIMULATION_TRUE = @SERIAL_SPEED_SIMULATION_TRUE@
 SERIAL_SUPPORT_FALSE = @SERIAL_SUPPORT_FALSE@
diff -Naur grub-0.97.orig/stage2/builtins.c grub-0.97/stage2/builtins.c
--- grub-0.97.orig/stage2/builtins.c	2005-02-15 22:58:23.000000000 +0100
+++ grub-0.97/stage2/builtins.c	2007-08-14 18:46:53.000000000 +0200
@@ -3880,6 +3880,7 @@
     {"jfs",      "/jfs_stage1_5"},
     {"minix",    "/minix_stage1_5"},
     {"reiserfs", "/reiserfs_stage1_5"},
+    {"reiser4",  "/reiser4_stage1_5"},
     {"vstafs",   "/vstafs_stage1_5"},
     {"xfs",      "/xfs_stage1_5"}
   };
diff -Naur grub-0.97.orig/stage2/disk_io.c grub-0.97/stage2/disk_io.c
--- grub-0.97.orig/stage2/disk_io.c	2004-05-23 18:35:24.000000000 +0200
+++ grub-0.97/stage2/disk_io.c	2007-08-14 18:46:53.000000000 +0200
@@ -63,6 +63,9 @@
 # ifdef FSYS_REISERFS
   {"reiserfs", reiserfs_mount, reiserfs_read, reiserfs_dir, 0, reiserfs_embed},
 # endif
+# ifdef FSYS_REISER4
+  {"reiser4", reiser4_mount, reiser4_read, reiser4_dir, 0, reiser4_embed},
+# endif
 # ifdef FSYS_VSTAFS
   {"vstafs", vstafs_mount, vstafs_read, vstafs_dir, 0, 0},
 # endif
diff -Naur grub-0.97.orig/stage2/filesys.h grub-0.97/stage2/filesys.h
--- grub-0.97.orig/stage2/filesys.h	2004-05-14 21:36:43.000000000 +0200
+++ grub-0.97/stage2/filesys.h	2007-08-14 18:46:53.000000000 +0200
@@ -77,6 +77,16 @@
 #define FSYS_REISERFS_NUM 0
 #endif
 
+#ifdef FSYS_REISER4
+#define FSYS_REISER4_NUM 1
+int reiser4_mount (void);
+int reiser4_read (char *buf, int len);
+int reiser4_dir (char *dirname);
+int reiser4_embed (int *start_sector, int needed_sectors);
+#else
+#define FSYS_REISER4_NUM 0
+#endif
+
 #ifdef FSYS_VSTAFS
 #define FSYS_VSTAFS_NUM 1
 int vstafs_mount (void);
@@ -127,8 +137,8 @@
 #ifndef NUM_FSYS
 #define NUM_FSYS	\
   (FSYS_FFS_NUM + FSYS_FAT_NUM + FSYS_EXT2FS_NUM + FSYS_MINIX_NUM	\
-   + FSYS_REISERFS_NUM + FSYS_VSTAFS_NUM + FSYS_JFS_NUM + FSYS_XFS_NUM	\
-   + FSYS_TFTP_NUM + FSYS_ISO9660_NUM + FSYS_UFS2_NUM)
+   + FSYS_REISERFS_NUM + FSYS_REISER4_NUM + FSYS_VSTAFS_NUM + FSYS_JFS_NUM \
+   + FSYS_XFS_NUM + FSYS_TFTP_NUM + FSYS_ISO9660_NUM + FSYS_UFS2_NUM)
 #endif
 
 /* defines for the block filesystem info area */
diff -Naur grub-0.97.orig/stage2/fsys_reiser4.c grub-0.97/stage2/fsys_reiser4.c
--- grub-0.97.orig/stage2/fsys_reiser4.c	1970-01-01 01:00:00.000000000 +0100
+++ grub-0.97/stage2/fsys_reiser4.c	2007-08-14 18:46:53.000000000 +0200
@@ -0,0 +1,260 @@
+/* 
+ *  fsys_reiser4.c -- reiser4 filesystem support.
+ *  Copyright (C) 2000, 2001   Free Software Foundation, Inc.
+ *  
+ *  GRUB  --  GRand Unified Bootloader
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
+*/
+
+#ifdef FSYS_REISER4
+#include "shared.h"
+#include "filesys.h"
+
+#define ENABLE_MINIMAL
+#include <reiser4/libreiser4.h>
+
+static reiser4_fs_t *fs = NULL;
+static aal_device_t *dev = NULL;
+static reiser4_object_t *object = NULL;
+
+/* Read callback of grub specific device. It uses devread() for reading passed
+   @count of device blocks starting from @blk to passed @buff. */
+static errno_t grub_dev_read(aal_device_t *device,
+			     void *buff, blk_t blk,
+			     count_t count)
+{
+	unsigned int size;
+	unsigned int factor;
+	unsigned int sector;
+
+	/* Calculating actual sector and size in bytes to be read from
+	   device. */
+	factor = device->blksize / SECTOR_SIZE;
+	sector = (unsigned int)blk << aal_log2(factor);
+	size = (unsigned int)count * (SECTOR_SIZE * factor);
+	
+	/* Reading from the current device */
+        if (!devread(sector, 0, size, buff))
+    	        return -EIO;
+		
+	return 0;
+}
+
+/* Length callback of grub device */
+static count_t grub_dev_len(aal_device_t *device) {
+	unsigned int factor;
+
+	/* Getting partition length in device blocks */
+	factor = device->blksize / SECTOR_SIZE;
+	return (part_length >> aal_log2(factor));
+}
+
+/*
+  Initializing grub device abstraction instance. It will use devread and friends
+  for providing needed functionality.
+*/
+struct aal_device_ops grub_dev_ops = {
+	.read   = grub_dev_read,
+	.len    = grub_dev_len
+};
+
+/* Initializes reiser4 */
+static int reiser4_init(void) {
+	extern aal_hash_table_t *plugins;
+	
+	plugins = NULL;
+
+	/* Initializing memory manager */
+	aal_mem_init((void *)FSYS_BUF, FSYS_BUFLEN);
+
+	/* Initializing device abstraction on current device GRUB uses. */
+	if (!(dev = aal_device_open(&grub_dev_ops, NULL,
+				    SECTOR_SIZE, 0)))
+	{
+		return 0;
+	}
+
+	/* Initializing libreiser4 (plugins, etc) */
+	return !libreiser4_init();
+}
+
+#define MEMORY_WATERMARK 8192
+
+/* Memory pressure detect function. */
+static int mpressure_detect(reiser4_tree_t *tree) {
+	return (aal_mem_free() <= MEMORY_WATERMARK);
+}
+
+/* Reiser4 mount() routine */
+int reiser4_mount(void) {
+	
+	/* Initialize all reiser4 related stuff first */
+	if (!reiser4_init())
+		return 0;
+	
+	/* Open filesystem on @dev. */
+	if (!(fs = reiser4_fs_open(dev)))
+		return 0;
+
+	fs->tree->mpc_func = mpressure_detect;
+	
+	object = NULL;
+	return 1;
+}
+
+/* Reiser4 read() handler */
+int reiser4_read(char *buf, int len) {
+	int64_t read;
+
+	if (object == NULL)
+		return 0;
+
+	/* Seet at current position denoted by @filepos */
+	if (objplug(object)->o.object_ops->seek) {
+		plug_call(objplug(object)->o.object_ops,
+			  seek, object->ent, filepos);
+	}
+	
+	/* Reading current file data starting from @filepos */
+	disk_read_func = disk_read_hook;
+	read = objplug(object)->o.object_ops->read ?
+		plug_call(objplug(object)->o.object_ops, read, 
+			  object->ent, buf, len) : -EINVAL;
+	disk_read_func = NULL;
+
+	if (read < 0) {
+		errnum = ERR_FSYS_CORRUPT;
+		return 0;
+	}
+
+    	filepos += read;
+	return read;
+}
+
+/* Reiser4 file open() routine */
+int reiser4_dir(char *dirname) {
+	char *ch;
+	
+	if (fs == NULL)
+		return 0;
+
+	if (object != NULL) {
+		plug_call(objplug(object)->o.object_ops, 
+			  close, object->ent);
+		aal_free(object);
+		object = NULL;
+	}
+
+	/* Cutting out string after first space character */
+    	if ((ch = aal_strchr(dirname, ' ')))
+		*ch = '\0';
+		
+	/* This function is also called for getting directory list for
+	   maintaining the bash-like completion. */
+#ifndef STAGE1_5
+	if (print_possibilities) {
+		char entry[256];
+		entry_hint_t entry_hint;
+		
+		/* Getting last part of name (jsut after last '/') */
+		if (*(dirname + aal_strlen(dirname) - 1) != '/') {
+		
+			if (!(ch = aal_strrchr(dirname, '/'))) {
+				errnum = ERR_BAD_FILETYPE;
+				return 0;
+			}
+
+			aal_strncpy(entry, ch + 1, sizeof(entry));
+			*(ch + 1) = '\0';
+		} else {
+			aal_memset(entry, 0, sizeof(entry));
+		}
+
+		/* Open obejct by @dirname */
+		if (!(object = reiser4_semantic_open(fs->tree, dirname, 
+						     NULL, 1))) 
+		{
+			errnum = ERR_FILE_NOT_FOUND;
+			return 0;
+		}
+
+		/* Checking if it is a directory object */
+		if (object->ent->opset.plug[OPSET_OBJ]->id.group != DIR_OBJECT)
+		{
+			/* If not, cutting out last '/' character */
+    			if ((ch = aal_strrchr(dirname, '/')))
+				*ch = '\0';
+
+			/* Close current object */
+			plug_call(objplug(object)->o.object_ops, 
+				  close, object->ent);
+			aal_free(object);
+			return 0;
+		}
+		
+		/* Reading the opened directory to build the completion list. */
+		if (objplug(object)->o.object_ops->readdir) {
+			while (plug_call(objplug(object)->o.object_ops, readdir,
+					 object->ent, &entry_hint) > 0) 
+			{
+				if (substring(entry, entry_hint.name) <= 0) {
+					if (print_possibilities > 0)
+						print_possibilities = 
+							-print_possibilities;
+				
+					print_a_completion(entry_hint.name);
+				}
+			}
+		}
+	} else {
+#endif
+		/* This is the case when resier4_dir() is called for open the
+		   file @dirname, not for building completion list. */
+		if (!(object = reiser4_semantic_open(fs->tree, dirname,
+						     NULL, 1))) 
+		{
+			errnum = ERR_FILE_NOT_FOUND;
+			return 0;
+		}
+		
+		if (object->ent->opset.plug[OPSET_OBJ]->id.group != REG_OBJECT)
+		{
+			errnum = ERR_BAD_FILETYPE;
+			return 0;
+		}
+		
+		/* Initializing GRUB global variables @filepos and @filemax. */
+		filepos = 0;
+		filemax = reiser4_object_size(object);
+	
+		return 1;
+#ifndef STAGE1_5
+	}
+
+	return 1;
+#endif
+
+	errnum = ERR_FILE_NOT_FOUND;
+	return 0;
+}
+
+/* Returns how many sectors may be used for embeding reiser4_stage1_5 in teh
+   case of installing GRUB to partition instead of MBR. */
+int reiser4_embed (int *start_sector, int needed_sectors) {
+	*start_sector = 1;
+	return needed_sectors <= ((REISER4_MASTER_OFFSET >> SECTOR_BITS) - 1);
+}
+#endif /* FSYS_REISER4 */
diff -Naur grub-0.97.orig/stage2/Makefile.in grub-0.97/stage2/Makefile.in
--- grub-0.97.orig/stage2/Makefile.in	2005-05-08 04:42:39.000000000 +0200
+++ grub-0.97/stage2/Makefile.in	2007-08-14 18:47:06.000000000 +0200
@@ -18,7 +18,7 @@
 
 
 
-SOURCES = $(libgrub_a_SOURCES) $(diskless_exec_SOURCES) $(e2fs_stage1_5_exec_SOURCES) $(fat_stage1_5_exec_SOURCES) $(ffs_stage1_5_exec_SOURCES) $(iso9660_stage1_5_exec_SOURCES) $(jfs_stage1_5_exec_SOURCES) $(minix_stage1_5_exec_SOURCES) $(nbloader_exec_SOURCES) $(pre_stage2_exec_SOURCES) $(pxeloader_exec_SOURCES) $(reiserfs_stage1_5_exec_SOURCES) $(start_exec_SOURCES) $(start_eltorito_exec_SOURCES) $(ufs2_stage1_5_exec_SOURCES) $(vstafs_stage1_5_exec_SOURCES) $(xfs_stage1_5_exec_SOURCES)
+SOURCES = $(libgrub_a_SOURCES) $(diskless_exec_SOURCES) $(e2fs_stage1_5_exec_SOURCES) $(fat_stage1_5_exec_SOURCES) $(ffs_stage1_5_exec_SOURCES) $(iso9660_stage1_5_exec_SOURCES) $(jfs_stage1_5_exec_SOURCES) $(minix_stage1_5_exec_SOURCES) $(nbloader_exec_SOURCES) $(pre_stage2_exec_SOURCES) $(pxeloader_exec_SOURCES) $(reiser4_stage1_5_exec_SOURCES) $(reiserfs_stage1_5_exec_SOURCES) $(start_exec_SOURCES) $(start_eltorito_exec_SOURCES) $(ufs2_stage1_5_exec_SOURCES) $(vstafs_stage1_5_exec_SOURCES) $(xfs_stage1_5_exec_SOURCES)
 
 srcdir = @srcdir@
 top_srcdir = @top_srcdir@
@@ -53,6 +53,7 @@
 @DISKLESS_SUPPORT_FALSE@	jfs_stage1_5.exec$(EXEEXT) \
 @DISKLESS_SUPPORT_FALSE@	minix_stage1_5.exec$(EXEEXT) \
 @DISKLESS_SUPPORT_FALSE@	reiserfs_stage1_5.exec$(EXEEXT) \
+@DISKLESS_SUPPORT_FALSE@	$(am__EXEEXT_1) \
 @DISKLESS_SUPPORT_FALSE@	ufs2_stage1_5.exec$(EXEEXT) \
 @DISKLESS_SUPPORT_FALSE@	vstafs_stage1_5.exec$(EXEEXT) \
 @DISKLESS_SUPPORT_FALSE@	xfs_stage1_5.exec$(EXEEXT)
@@ -66,6 +67,7 @@
 @DISKLESS_SUPPORT_TRUE@	jfs_stage1_5.exec$(EXEEXT) \
 @DISKLESS_SUPPORT_TRUE@	minix_stage1_5.exec$(EXEEXT) \
 @DISKLESS_SUPPORT_TRUE@	reiserfs_stage1_5.exec$(EXEEXT) \
+@DISKLESS_SUPPORT_TRUE@	$(am__EXEEXT_1) \
 @DISKLESS_SUPPORT_TRUE@	ufs2_stage1_5.exec$(EXEEXT) \
 @DISKLESS_SUPPORT_TRUE@	vstafs_stage1_5.exec$(EXEEXT) \
 @DISKLESS_SUPPORT_TRUE@	xfs_stage1_5.exec$(EXEEXT) \
@@ -96,12 +98,14 @@
 	libgrub_a-fsys_iso9660.$(OBJEXT) libgrub_a-fsys_jfs.$(OBJEXT) \
 	libgrub_a-fsys_minix.$(OBJEXT) \
 	libgrub_a-fsys_reiserfs.$(OBJEXT) \
-	libgrub_a-fsys_ufs2.$(OBJEXT) libgrub_a-fsys_vstafs.$(OBJEXT) \
-	libgrub_a-fsys_xfs.$(OBJEXT) libgrub_a-gunzip.$(OBJEXT) \
-	libgrub_a-md5.$(OBJEXT) libgrub_a-serial.$(OBJEXT) \
-	libgrub_a-stage2.$(OBJEXT) libgrub_a-terminfo.$(OBJEXT) \
-	libgrub_a-tparm.$(OBJEXT)
+	libgrub_a-fsys_reiser4.$(OBJEXT) libgrub_a-fsys_ufs2.$(OBJEXT) \
+	libgrub_a-fsys_vstafs.$(OBJEXT) libgrub_a-fsys_xfs.$(OBJEXT) \
+	libgrub_a-gunzip.$(OBJEXT) libgrub_a-md5.$(OBJEXT) \
+	libgrub_a-serial.$(OBJEXT) libgrub_a-stage2.$(OBJEXT) \
+	libgrub_a-terminfo.$(OBJEXT) libgrub_a-tparm.$(OBJEXT)
 libgrub_a_OBJECTS = $(am_libgrub_a_OBJECTS)
+@ENABLE_REISER4_SUPPORT_TRUE@am__EXEEXT_1 =  \
+@ENABLE_REISER4_SUPPORT_TRUE@	reiser4_stage1_5.exec$(EXEEXT)
 PROGRAMS = $(noinst_PROGRAMS)
 am__objects_1 = diskless_exec-asm.$(OBJEXT) \
 	diskless_exec-bios.$(OBJEXT) diskless_exec-boot.$(OBJEXT) \
@@ -117,6 +121,7 @@
 	diskless_exec-fsys_jfs.$(OBJEXT) \
 	diskless_exec-fsys_minix.$(OBJEXT) \
 	diskless_exec-fsys_reiserfs.$(OBJEXT) \
+	diskless_exec-fsys_reiser4.$(OBJEXT) \
 	diskless_exec-fsys_ufs2.$(OBJEXT) \
 	diskless_exec-fsys_vstafs.$(OBJEXT) \
 	diskless_exec-fsys_xfs.$(OBJEXT) \
@@ -208,6 +213,7 @@
 	pre_stage2_exec-fsys_jfs.$(OBJEXT) \
 	pre_stage2_exec-fsys_minix.$(OBJEXT) \
 	pre_stage2_exec-fsys_reiserfs.$(OBJEXT) \
+	pre_stage2_exec-fsys_reiser4.$(OBJEXT) \
 	pre_stage2_exec-fsys_ufs2.$(OBJEXT) \
 	pre_stage2_exec-fsys_vstafs.$(OBJEXT) \
 	pre_stage2_exec-fsys_xfs.$(OBJEXT) \
@@ -219,11 +225,26 @@
 	pre_stage2_exec-terminfo.$(OBJEXT) \
 	pre_stage2_exec-tparm.$(OBJEXT)
 pre_stage2_exec_OBJECTS = $(am_pre_stage2_exec_OBJECTS)
+am__DEPENDENCIES_1 =
+@NETBOOT_SUPPORT_FALSE@pre_stage2_exec_DEPENDENCIES =  \
+@NETBOOT_SUPPORT_FALSE@	$(am__DEPENDENCIES_1)
 @NETBOOT_SUPPORT_TRUE@pre_stage2_exec_DEPENDENCIES =  \
-@NETBOOT_SUPPORT_TRUE@	../netboot/libdrivers.a
+@NETBOOT_SUPPORT_TRUE@	../netboot/libdrivers.a \
+@NETBOOT_SUPPORT_TRUE@	$(am__DEPENDENCIES_1)
 am_pxeloader_exec_OBJECTS = pxeloader_exec-pxeloader.$(OBJEXT)
 pxeloader_exec_OBJECTS = $(am_pxeloader_exec_OBJECTS)
 pxeloader_exec_LDADD = $(LDADD)
+am_reiser4_stage1_5_exec_OBJECTS =  \
+	reiser4_stage1_5_exec-start.$(OBJEXT) \
+	reiser4_stage1_5_exec-asm.$(OBJEXT) \
+	reiser4_stage1_5_exec-common.$(OBJEXT) \
+	reiser4_stage1_5_exec-char_io.$(OBJEXT) \
+	reiser4_stage1_5_exec-disk_io.$(OBJEXT) \
+	reiser4_stage1_5_exec-stage1_5.$(OBJEXT) \
+	reiser4_stage1_5_exec-fsys_reiser4.$(OBJEXT) \
+	reiser4_stage1_5_exec-bios.$(OBJEXT)
+reiser4_stage1_5_exec_OBJECTS = $(am_reiser4_stage1_5_exec_OBJECTS)
+reiser4_stage1_5_exec_DEPENDENCIES = $(am__DEPENDENCIES_1)
 am_reiserfs_stage1_5_exec_OBJECTS =  \
 	reiserfs_stage1_5_exec-start.$(OBJEXT) \
 	reiserfs_stage1_5_exec-asm.$(OBJEXT) \
@@ -287,19 +308,19 @@
 	$(ffs_stage1_5_exec_SOURCES) $(iso9660_stage1_5_exec_SOURCES) \
 	$(jfs_stage1_5_exec_SOURCES) $(minix_stage1_5_exec_SOURCES) \
 	$(nbloader_exec_SOURCES) $(pre_stage2_exec_SOURCES) \
-	$(pxeloader_exec_SOURCES) $(reiserfs_stage1_5_exec_SOURCES) \
-	$(start_exec_SOURCES) $(start_eltorito_exec_SOURCES) \
-	$(ufs2_stage1_5_exec_SOURCES) $(vstafs_stage1_5_exec_SOURCES) \
-	$(xfs_stage1_5_exec_SOURCES)
+	$(pxeloader_exec_SOURCES) $(reiser4_stage1_5_exec_SOURCES) \
+	$(reiserfs_stage1_5_exec_SOURCES) $(start_exec_SOURCES) \
+	$(start_eltorito_exec_SOURCES) $(ufs2_stage1_5_exec_SOURCES) \
+	$(vstafs_stage1_5_exec_SOURCES) $(xfs_stage1_5_exec_SOURCES)
 DIST_SOURCES = $(libgrub_a_SOURCES) $(diskless_exec_SOURCES) \
 	$(e2fs_stage1_5_exec_SOURCES) $(fat_stage1_5_exec_SOURCES) \
 	$(ffs_stage1_5_exec_SOURCES) $(iso9660_stage1_5_exec_SOURCES) \
 	$(jfs_stage1_5_exec_SOURCES) $(minix_stage1_5_exec_SOURCES) \
 	$(nbloader_exec_SOURCES) $(pre_stage2_exec_SOURCES) \
-	$(pxeloader_exec_SOURCES) $(reiserfs_stage1_5_exec_SOURCES) \
-	$(start_exec_SOURCES) $(start_eltorito_exec_SOURCES) \
-	$(ufs2_stage1_5_exec_SOURCES) $(vstafs_stage1_5_exec_SOURCES) \
-	$(xfs_stage1_5_exec_SOURCES)
+	$(pxeloader_exec_SOURCES) $(reiser4_stage1_5_exec_SOURCES) \
+	$(reiserfs_stage1_5_exec_SOURCES) $(start_exec_SOURCES) \
+	$(start_eltorito_exec_SOURCES) $(ufs2_stage1_5_exec_SOURCES) \
+	$(vstafs_stage1_5_exec_SOURCES) $(xfs_stage1_5_exec_SOURCES)
 am__vpath_adj_setup = srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`;
 am__vpath_adj = case $$p in \
     $(srcdir)/*) f=`echo "$$p" | sed "s|^$$srcdirstrip/||"`;; \
@@ -342,6 +363,8 @@
 ECHO_N = @ECHO_N@
 ECHO_T = @ECHO_T@
 EGREP = @EGREP@
+ENABLE_REISER4_SUPPORT_FALSE = @ENABLE_REISER4_SUPPORT_FALSE@
+ENABLE_REISER4_SUPPORT_TRUE = @ENABLE_REISER4_SUPPORT_TRUE@
 EXEEXT = @EXEEXT@
 FSYS_CFLAGS = @FSYS_CFLAGS@
 GRUB_CFLAGS = @GRUB_CFLAGS@
@@ -376,6 +399,8 @@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
 RANLIB = @RANLIB@
+REISER4_CFLAGS = @REISER4_CFLAGS@
+REISER4_LIBS = @REISER4_LIBS@
 SERIAL_SPEED_SIMULATION_FALSE = @SERIAL_SPEED_SIMULATION_FALSE@
 SERIAL_SPEED_SIMULATION_TRUE = @SERIAL_SPEED_SIMULATION_TRUE@
 SERIAL_SUPPORT_FALSE = @SERIAL_SUPPORT_FALSE@
@@ -441,29 +466,34 @@
 
 # For <stage1.h>.
 INCLUDES = -I$(top_srcdir)/stage1
+@ENABLE_REISER4_SUPPORT_FALSE@REISER4_STAGE1_5 = 
+@ENABLE_REISER4_SUPPORT_TRUE@REISER4_STAGE1_5 = reiser4_stage1_5
+@ENABLE_REISER4_SUPPORT_FALSE@REISER4_STAGE1_5_EXEC = 
+@ENABLE_REISER4_SUPPORT_TRUE@REISER4_STAGE1_5_EXEC = reiser4_stage1_5.exec
 
 # The library for /sbin/grub.
 noinst_LIBRARIES = libgrub.a
 libgrub_a_SOURCES = boot.c builtins.c char_io.c cmdline.c common.c \
 	disk_io.c fsys_ext2fs.c fsys_fat.c fsys_ffs.c fsys_iso9660.c \
-	fsys_jfs.c fsys_minix.c fsys_reiserfs.c fsys_ufs2.c \
+	fsys_jfs.c fsys_minix.c fsys_reiserfs.c fsys_reiser4.c fsys_ufs2.c \
 	fsys_vstafs.c fsys_xfs.c gunzip.c md5.c serial.c stage2.c \
 	terminfo.c tparm.c
 
 libgrub_a_CFLAGS = $(GRUB_CFLAGS) -I$(top_srcdir)/lib \
 	-DGRUB_UTIL=1 -DFSYS_EXT2FS=1 -DFSYS_FAT=1 -DFSYS_FFS=1 \
 	-DFSYS_ISO9660=1 -DFSYS_JFS=1 -DFSYS_MINIX=1 -DFSYS_REISERFS=1 \
-	-DFSYS_UFS2=1 -DFSYS_VSTAFS=1 -DFSYS_XFS=1 \
+	$(REISER4_CFLAGS) -DFSYS_UFS2=1 -DFSYS_VSTAFS=1 -DFSYS_XFS=1 \
 	-DUSE_MD5_PASSWORDS=1 -DSUPPORT_SERIAL=1 -DSUPPORT_HERCULES=1
 
 @DISKLESS_SUPPORT_FALSE@pkglib_DATA = stage2 stage2_eltorito e2fs_stage1_5 fat_stage1_5 \
 @DISKLESS_SUPPORT_FALSE@	ffs_stage1_5 iso9660_stage1_5 jfs_stage1_5 minix_stage1_5 \
-@DISKLESS_SUPPORT_FALSE@	reiserfs_stage1_5 ufs2_stage1_5 vstafs_stage1_5 xfs_stage1_5
+@DISKLESS_SUPPORT_FALSE@	reiserfs_stage1_5 $(REISER4_STAGE1_5) ufs2_stage1_5 \
+@DISKLESS_SUPPORT_FALSE@	vstafs_stage1_5 xfs_stage1_5
 
 @DISKLESS_SUPPORT_TRUE@pkglib_DATA = stage2 stage2_eltorito e2fs_stage1_5 fat_stage1_5 \
 @DISKLESS_SUPPORT_TRUE@	ffs_stage1_5 iso9660_stage1_5 jfs_stage1_5 minix_stage1_5 \
-@DISKLESS_SUPPORT_TRUE@	reiserfs_stage1_5 ufs2_stage1_5 vstafs_stage1_5 xfs_stage1_5 \
-@DISKLESS_SUPPORT_TRUE@	nbgrub pxegrub
+@DISKLESS_SUPPORT_TRUE@	reiserfs_stage1_5 $(REISER4_STAGE1_5) ufs2_stage1_5 \
+@DISKLESS_SUPPORT_TRUE@	vstafs_stage1_5 xfs_stage1_5 nbgrub pxegrub
 
 @DISKLESS_SUPPORT_FALSE@noinst_DATA = pre_stage2 start start_eltorito
 @DISKLESS_SUPPORT_TRUE@noinst_DATA = pre_stage2 start start_eltorito nbloader pxeloader diskless
@@ -479,7 +509,7 @@
 @SERIAL_SUPPORT_TRUE@SERIAL_FLAGS = -DSUPPORT_SERIAL=1
 @HERCULES_SUPPORT_FALSE@HERCULES_FLAGS = 
 @HERCULES_SUPPORT_TRUE@HERCULES_FLAGS = -DSUPPORT_HERCULES=1
-STAGE2_COMPILE = $(STAGE2_CFLAGS) -fno-builtin -nostdinc \
+STAGE2_COMPILE = $(STAGE2_CFLAGS) -fno-builtin \
 	$(NETBOOT_FLAGS) $(SERIAL_FLAGS) $(HERCULES_FLAGS)
 
 STAGE1_5_LINK = -nostdlib -Wl,-N -Wl,-Ttext -Wl,2000
@@ -489,13 +519,15 @@
 pre_stage2_exec_SOURCES = asm.S bios.c boot.c builtins.c char_io.c \
 	cmdline.c common.c console.c disk_io.c fsys_ext2fs.c \
 	fsys_fat.c fsys_ffs.c fsys_iso9660.c fsys_jfs.c fsys_minix.c \
-	fsys_reiserfs.c fsys_ufs2.c fsys_vstafs.c fsys_xfs.c gunzip.c \
-	hercules.c md5.c serial.c smp-imps.c stage2.c terminfo.c tparm.c
+	fsys_reiserfs.c fsys_reiser4.c fsys_ufs2.c fsys_vstafs.c \
+	fsys_xfs.c gunzip.c hercules.c md5.c serial.c smp-imps.c \
+	stage2.c terminfo.c tparm.c
 
 pre_stage2_exec_CFLAGS = $(STAGE2_COMPILE) $(FSYS_CFLAGS)
 pre_stage2_exec_CCASFLAGS = $(STAGE2_COMPILE) $(FSYS_CFLAGS)
 pre_stage2_exec_LDFLAGS = $(PRE_STAGE2_LINK)
-@NETBOOT_SUPPORT_TRUE@pre_stage2_exec_LDADD = ../netboot/libdrivers.a
+@NETBOOT_SUPPORT_FALSE@pre_stage2_exec_LDADD = $(REISER4_LIBS)
+@NETBOOT_SUPPORT_TRUE@pre_stage2_exec_LDADD = ../netboot/libdrivers.a $(REISER4_LIBS)
 @DISKLESS_SUPPORT_FALSE@BUILT_SOURCES = stage2_size.h
 @DISKLESS_SUPPORT_TRUE@BUILT_SOURCES = stage2_size.h diskless_size.h
 CLEANFILES = $(pkglib_DATA) $(noinst_DATA) $(BUILT_SOURCES)
@@ -578,6 +610,19 @@
 
 reiserfs_stage1_5_exec_LDFLAGS = $(STAGE1_5_LINK)
 
+# For reiser4_stage1_5 target.
+reiser4_stage1_5_exec_SOURCES = start.S asm.S common.c char_io.c \
+	disk_io.c stage1_5.c fsys_reiser4.c bios.c
+
+reiser4_stage1_5_exec_CFLAGS = $(STAGE1_5_COMPILE) $(REISER4_CFLAGS) \
+	-DNO_BLOCK_FILES=1
+
+reiser4_stage1_5_exec_CCASFLAGS = $(STAGE1_5_COMPILE) $(REISER4_CFLAGS) \
+	-DNO_BLOCK_FILES=1
+
+reiser4_stage1_5_exec_LDFLAGS = $(STAGE1_5_LINK)
+reiser4_stage1_5_exec_LDADD = $(REISER4_LIBS)
+
 # For vstafs_stage1_5 target.
 vstafs_stage1_5_exec_SOURCES = start.S asm.S common.c char_io.c \
 	disk_io.c stage1_5.c fsys_vstafs.c bios.c
@@ -723,6 +768,9 @@
 pxeloader.exec$(EXEEXT): $(pxeloader_exec_OBJECTS) $(pxeloader_exec_DEPENDENCIES) 
 	@rm -f pxeloader.exec$(EXEEXT)
 	$(LINK) $(pxeloader_exec_LDFLAGS) $(pxeloader_exec_OBJECTS) $(pxeloader_exec_LDADD) $(LIBS)
+reiser4_stage1_5.exec$(EXEEXT): $(reiser4_stage1_5_exec_OBJECTS) $(reiser4_stage1_5_exec_DEPENDENCIES) 
+	@rm -f reiser4_stage1_5.exec$(EXEEXT)
+	$(LINK) $(reiser4_stage1_5_exec_LDFLAGS) $(reiser4_stage1_5_exec_OBJECTS) $(reiser4_stage1_5_exec_LDADD) $(LIBS)
 reiserfs_stage1_5.exec$(EXEEXT): $(reiserfs_stage1_5_exec_OBJECTS) $(reiserfs_stage1_5_exec_DEPENDENCIES) 
 	@rm -f reiserfs_stage1_5.exec$(EXEEXT)
 	$(LINK) $(reiserfs_stage1_5_exec_LDFLAGS) $(reiserfs_stage1_5_exec_OBJECTS) $(reiserfs_stage1_5_exec_LDADD) $(LIBS)
@@ -762,6 +810,7 @@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/diskless_exec-fsys_iso9660.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/diskless_exec-fsys_jfs.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/diskless_exec-fsys_minix.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/diskless_exec-fsys_reiser4.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/diskless_exec-fsys_reiserfs.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/diskless_exec-fsys_ufs2.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/diskless_exec-fsys_vstafs.Po@am__quote@
@@ -816,6 +865,7 @@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgrub_a-fsys_iso9660.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgrub_a-fsys_jfs.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgrub_a-fsys_minix.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgrub_a-fsys_reiser4.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgrub_a-fsys_reiserfs.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgrub_a-fsys_ufs2.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgrub_a-fsys_vstafs.Po@am__quote@
@@ -846,6 +896,7 @@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/pre_stage2_exec-fsys_iso9660.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/pre_stage2_exec-fsys_jfs.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/pre_stage2_exec-fsys_minix.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/pre_stage2_exec-fsys_reiser4.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/pre_stage2_exec-fsys_reiserfs.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/pre_stage2_exec-fsys_ufs2.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/pre_stage2_exec-fsys_vstafs.Po@am__quote@
@@ -858,6 +909,12 @@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/pre_stage2_exec-stage2.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/pre_stage2_exec-terminfo.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/pre_stage2_exec-tparm.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/reiser4_stage1_5_exec-bios.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/reiser4_stage1_5_exec-char_io.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/reiser4_stage1_5_exec-common.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/reiser4_stage1_5_exec-disk_io.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/reiser4_stage1_5_exec-fsys_reiser4.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/reiser4_stage1_5_exec-stage1_5.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/reiserfs_stage1_5_exec-bios.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/reiserfs_stage1_5_exec-char_io.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/reiserfs_stage1_5_exec-common.Po@am__quote@
@@ -985,6 +1042,18 @@
 pxeloader_exec-pxeloader.obj: pxeloader.S
 	$(CCAS) $(pxeloader_exec_CCASFLAGS) $(CCASFLAGS) -c -o pxeloader_exec-pxeloader.obj `if test -f 'pxeloader.S'; then $(CYGPATH_W) 'pxeloader.S'; else $(CYGPATH_W) '$(srcdir)/pxeloader.S'; fi`
 
+reiser4_stage1_5_exec-start.o: start.S
+	$(CCAS) $(reiser4_stage1_5_exec_CCASFLAGS) $(CCASFLAGS) -c -o reiser4_stage1_5_exec-start.o `test -f 'start.S' || echo '$(srcdir)/'`start.S
+
+reiser4_stage1_5_exec-start.obj: start.S
+	$(CCAS) $(reiser4_stage1_5_exec_CCASFLAGS) $(CCASFLAGS) -c -o reiser4_stage1_5_exec-start.obj `if test -f 'start.S'; then $(CYGPATH_W) 'start.S'; else $(CYGPATH_W) '$(srcdir)/start.S'; fi`
+
+reiser4_stage1_5_exec-asm.o: asm.S
+	$(CCAS) $(reiser4_stage1_5_exec_CCASFLAGS) $(CCASFLAGS) -c -o reiser4_stage1_5_exec-asm.o `test -f 'asm.S' || echo '$(srcdir)/'`asm.S
+
+reiser4_stage1_5_exec-asm.obj: asm.S
+	$(CCAS) $(reiser4_stage1_5_exec_CCASFLAGS) $(CCASFLAGS) -c -o reiser4_stage1_5_exec-asm.obj `if test -f 'asm.S'; then $(CYGPATH_W) 'asm.S'; else $(CYGPATH_W) '$(srcdir)/asm.S'; fi`
+
 reiserfs_stage1_5_exec-start.o: start.S
 	$(CCAS) $(reiserfs_stage1_5_exec_CCASFLAGS) $(CCASFLAGS) -c -o reiserfs_stage1_5_exec-start.o `test -f 'start.S' || echo '$(srcdir)/'`start.S
 
@@ -1241,6 +1310,20 @@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgrub_a_CFLAGS) $(CFLAGS) -c -o libgrub_a-fsys_reiserfs.obj `if test -f 'fsys_reiserfs.c'; then $(CYGPATH_W) 'fsys_reiserfs.c'; else $(CYGPATH_W) '$(srcdir)/fsys_reiserfs.c'; fi`
 
+libgrub_a-fsys_reiser4.o: fsys_reiser4.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgrub_a_CFLAGS) $(CFLAGS) -MT libgrub_a-fsys_reiser4.o -MD -MP -MF "$(DEPDIR)/libgrub_a-fsys_reiser4.Tpo" -c -o libgrub_a-fsys_reiser4.o `test -f 'fsys_reiser4.c' || echo '$(srcdir)/'`fsys_reiser4.c; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/libgrub_a-fsys_reiser4.Tpo" "$(DEPDIR)/libgrub_a-fsys_reiser4.Po"; else rm -f "$(DEPDIR)/libgrub_a-fsys_reiser4.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fsys_reiser4.c' object='libgrub_a-fsys_reiser4.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgrub_a_CFLAGS) $(CFLAGS) -c -o libgrub_a-fsys_reiser4.o `test -f 'fsys_reiser4.c' || echo '$(srcdir)/'`fsys_reiser4.c
+
+libgrub_a-fsys_reiser4.obj: fsys_reiser4.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgrub_a_CFLAGS) $(CFLAGS) -MT libgrub_a-fsys_reiser4.obj -MD -MP -MF "$(DEPDIR)/libgrub_a-fsys_reiser4.Tpo" -c -o libgrub_a-fsys_reiser4.obj `if test -f 'fsys_reiser4.c'; then $(CYGPATH_W) 'fsys_reiser4.c'; else $(CYGPATH_W) '$(srcdir)/fsys_reiser4.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/libgrub_a-fsys_reiser4.Tpo" "$(DEPDIR)/libgrub_a-fsys_reiser4.Po"; else rm -f "$(DEPDIR)/libgrub_a-fsys_reiser4.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fsys_reiser4.c' object='libgrub_a-fsys_reiser4.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgrub_a_CFLAGS) $(CFLAGS) -c -o libgrub_a-fsys_reiser4.obj `if test -f 'fsys_reiser4.c'; then $(CYGPATH_W) 'fsys_reiser4.c'; else $(CYGPATH_W) '$(srcdir)/fsys_reiser4.c'; fi`
+
 libgrub_a-fsys_ufs2.o: fsys_ufs2.c
 @am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgrub_a_CFLAGS) $(CFLAGS) -MT libgrub_a-fsys_ufs2.o -MD -MP -MF "$(DEPDIR)/libgrub_a-fsys_ufs2.Tpo" -c -o libgrub_a-fsys_ufs2.o `test -f 'fsys_ufs2.c' || echo '$(srcdir)/'`fsys_ufs2.c; \
 @am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/libgrub_a-fsys_ufs2.Tpo" "$(DEPDIR)/libgrub_a-fsys_ufs2.Po"; else rm -f "$(DEPDIR)/libgrub_a-fsys_ufs2.Tpo"; exit 1; fi
@@ -1577,6 +1660,20 @@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(diskless_exec_CFLAGS) $(CFLAGS) -c -o diskless_exec-fsys_reiserfs.obj `if test -f 'fsys_reiserfs.c'; then $(CYGPATH_W) 'fsys_reiserfs.c'; else $(CYGPATH_W) '$(srcdir)/fsys_reiserfs.c'; fi`
 
+diskless_exec-fsys_reiser4.o: fsys_reiser4.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(diskless_exec_CFLAGS) $(CFLAGS) -MT diskless_exec-fsys_reiser4.o -MD -MP -MF "$(DEPDIR)/diskless_exec-fsys_reiser4.Tpo" -c -o diskless_exec-fsys_reiser4.o `test -f 'fsys_reiser4.c' || echo '$(srcdir)/'`fsys_reiser4.c; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/diskless_exec-fsys_reiser4.Tpo" "$(DEPDIR)/diskless_exec-fsys_reiser4.Po"; else rm -f "$(DEPDIR)/diskless_exec-fsys_reiser4.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fsys_reiser4.c' object='diskless_exec-fsys_reiser4.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(diskless_exec_CFLAGS) $(CFLAGS) -c -o diskless_exec-fsys_reiser4.o `test -f 'fsys_reiser4.c' || echo '$(srcdir)/'`fsys_reiser4.c
+
+diskless_exec-fsys_reiser4.obj: fsys_reiser4.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(diskless_exec_CFLAGS) $(CFLAGS) -MT diskless_exec-fsys_reiser4.obj -MD -MP -MF "$(DEPDIR)/diskless_exec-fsys_reiser4.Tpo" -c -o diskless_exec-fsys_reiser4.obj `if test -f 'fsys_reiser4.c'; then $(CYGPATH_W) 'fsys_reiser4.c'; else $(CYGPATH_W) '$(srcdir)/fsys_reiser4.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/diskless_exec-fsys_reiser4.Tpo" "$(DEPDIR)/diskless_exec-fsys_reiser4.Po"; else rm -f "$(DEPDIR)/diskless_exec-fsys_reiser4.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fsys_reiser4.c' object='diskless_exec-fsys_reiser4.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(diskless_exec_CFLAGS) $(CFLAGS) -c -o diskless_exec-fsys_reiser4.obj `if test -f 'fsys_reiser4.c'; then $(CYGPATH_W) 'fsys_reiser4.c'; else $(CYGPATH_W) '$(srcdir)/fsys_reiser4.c'; fi`
+
 diskless_exec-fsys_ufs2.o: fsys_ufs2.c
 @am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(diskless_exec_CFLAGS) $(CFLAGS) -MT diskless_exec-fsys_ufs2.o -MD -MP -MF "$(DEPDIR)/diskless_exec-fsys_ufs2.Tpo" -c -o diskless_exec-fsys_ufs2.o `test -f 'fsys_ufs2.c' || echo '$(srcdir)/'`fsys_ufs2.c; \
 @am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/diskless_exec-fsys_ufs2.Tpo" "$(DEPDIR)/diskless_exec-fsys_ufs2.Po"; else rm -f "$(DEPDIR)/diskless_exec-fsys_ufs2.Tpo"; exit 1; fi
@@ -2445,6 +2542,20 @@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(pre_stage2_exec_CFLAGS) $(CFLAGS) -c -o pre_stage2_exec-fsys_reiserfs.obj `if test -f 'fsys_reiserfs.c'; then $(CYGPATH_W) 'fsys_reiserfs.c'; else $(CYGPATH_W) '$(srcdir)/fsys_reiserfs.c'; fi`
 
+pre_stage2_exec-fsys_reiser4.o: fsys_reiser4.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(pre_stage2_exec_CFLAGS) $(CFLAGS) -MT pre_stage2_exec-fsys_reiser4.o -MD -MP -MF "$(DEPDIR)/pre_stage2_exec-fsys_reiser4.Tpo" -c -o pre_stage2_exec-fsys_reiser4.o `test -f 'fsys_reiser4.c' || echo '$(srcdir)/'`fsys_reiser4.c; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/pre_stage2_exec-fsys_reiser4.Tpo" "$(DEPDIR)/pre_stage2_exec-fsys_reiser4.Po"; else rm -f "$(DEPDIR)/pre_stage2_exec-fsys_reiser4.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fsys_reiser4.c' object='pre_stage2_exec-fsys_reiser4.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(pre_stage2_exec_CFLAGS) $(CFLAGS) -c -o pre_stage2_exec-fsys_reiser4.o `test -f 'fsys_reiser4.c' || echo '$(srcdir)/'`fsys_reiser4.c
+
+pre_stage2_exec-fsys_reiser4.obj: fsys_reiser4.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(pre_stage2_exec_CFLAGS) $(CFLAGS) -MT pre_stage2_exec-fsys_reiser4.obj -MD -MP -MF "$(DEPDIR)/pre_stage2_exec-fsys_reiser4.Tpo" -c -o pre_stage2_exec-fsys_reiser4.obj `if test -f 'fsys_reiser4.c'; then $(CYGPATH_W) 'fsys_reiser4.c'; else $(CYGPATH_W) '$(srcdir)/fsys_reiser4.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/pre_stage2_exec-fsys_reiser4.Tpo" "$(DEPDIR)/pre_stage2_exec-fsys_reiser4.Po"; else rm -f "$(DEPDIR)/pre_stage2_exec-fsys_reiser4.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fsys_reiser4.c' object='pre_stage2_exec-fsys_reiser4.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(pre_stage2_exec_CFLAGS) $(CFLAGS) -c -o pre_stage2_exec-fsys_reiser4.obj `if test -f 'fsys_reiser4.c'; then $(CYGPATH_W) 'fsys_reiser4.c'; else $(CYGPATH_W) '$(srcdir)/fsys_reiser4.c'; fi`
+
 pre_stage2_exec-fsys_ufs2.o: fsys_ufs2.c
 @am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(pre_stage2_exec_CFLAGS) $(CFLAGS) -MT pre_stage2_exec-fsys_ufs2.o -MD -MP -MF "$(DEPDIR)/pre_stage2_exec-fsys_ufs2.Tpo" -c -o pre_stage2_exec-fsys_ufs2.o `test -f 'fsys_ufs2.c' || echo '$(srcdir)/'`fsys_ufs2.c; \
 @am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/pre_stage2_exec-fsys_ufs2.Tpo" "$(DEPDIR)/pre_stage2_exec-fsys_ufs2.Po"; else rm -f "$(DEPDIR)/pre_stage2_exec-fsys_ufs2.Tpo"; exit 1; fi
@@ -2599,6 +2710,90 @@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(pre_stage2_exec_CFLAGS) $(CFLAGS) -c -o pre_stage2_exec-tparm.obj `if test -f 'tparm.c'; then $(CYGPATH_W) 'tparm.c'; else $(CYGPATH_W) '$(srcdir)/tparm.c'; fi`
 
+reiser4_stage1_5_exec-common.o: common.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(reiser4_stage1_5_exec_CFLAGS) $(CFLAGS) -MT reiser4_stage1_5_exec-common.o -MD -MP -MF "$(DEPDIR)/reiser4_stage1_5_exec-common.Tpo" -c -o reiser4_stage1_5_exec-common.o `test -f 'common.c' || echo '$(srcdir)/'`common.c; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/reiser4_stage1_5_exec-common.Tpo" "$(DEPDIR)/reiser4_stage1_5_exec-common.Po"; else rm -f "$(DEPDIR)/reiser4_stage1_5_exec-common.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='common.c' object='reiser4_stage1_5_exec-common.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(reiser4_stage1_5_exec_CFLAGS) $(CFLAGS) -c -o reiser4_stage1_5_exec-common.o `test -f 'common.c' || echo '$(srcdir)/'`common.c
+
+reiser4_stage1_5_exec-common.obj: common.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(reiser4_stage1_5_exec_CFLAGS) $(CFLAGS) -MT reiser4_stage1_5_exec-common.obj -MD -MP -MF "$(DEPDIR)/reiser4_stage1_5_exec-common.Tpo" -c -o reiser4_stage1_5_exec-common.obj `if test -f 'common.c'; then $(CYGPATH_W) 'common.c'; else $(CYGPATH_W) '$(srcdir)/common.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/reiser4_stage1_5_exec-common.Tpo" "$(DEPDIR)/reiser4_stage1_5_exec-common.Po"; else rm -f "$(DEPDIR)/reiser4_stage1_5_exec-common.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='common.c' object='reiser4_stage1_5_exec-common.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(reiser4_stage1_5_exec_CFLAGS) $(CFLAGS) -c -o reiser4_stage1_5_exec-common.obj `if test -f 'common.c'; then $(CYGPATH_W) 'common.c'; else $(CYGPATH_W) '$(srcdir)/common.c'; fi`
+
+reiser4_stage1_5_exec-char_io.o: char_io.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(reiser4_stage1_5_exec_CFLAGS) $(CFLAGS) -MT reiser4_stage1_5_exec-char_io.o -MD -MP -MF "$(DEPDIR)/reiser4_stage1_5_exec-char_io.Tpo" -c -o reiser4_stage1_5_exec-char_io.o `test -f 'char_io.c' || echo '$(srcdir)/'`char_io.c; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/reiser4_stage1_5_exec-char_io.Tpo" "$(DEPDIR)/reiser4_stage1_5_exec-char_io.Po"; else rm -f "$(DEPDIR)/reiser4_stage1_5_exec-char_io.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='char_io.c' object='reiser4_stage1_5_exec-char_io.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(reiser4_stage1_5_exec_CFLAGS) $(CFLAGS) -c -o reiser4_stage1_5_exec-char_io.o `test -f 'char_io.c' || echo '$(srcdir)/'`char_io.c
+
+reiser4_stage1_5_exec-char_io.obj: char_io.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(reiser4_stage1_5_exec_CFLAGS) $(CFLAGS) -MT reiser4_stage1_5_exec-char_io.obj -MD -MP -MF "$(DEPDIR)/reiser4_stage1_5_exec-char_io.Tpo" -c -o reiser4_stage1_5_exec-char_io.obj `if test -f 'char_io.c'; then $(CYGPATH_W) 'char_io.c'; else $(CYGPATH_W) '$(srcdir)/char_io.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/reiser4_stage1_5_exec-char_io.Tpo" "$(DEPDIR)/reiser4_stage1_5_exec-char_io.Po"; else rm -f "$(DEPDIR)/reiser4_stage1_5_exec-char_io.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='char_io.c' object='reiser4_stage1_5_exec-char_io.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(reiser4_stage1_5_exec_CFLAGS) $(CFLAGS) -c -o reiser4_stage1_5_exec-char_io.obj `if test -f 'char_io.c'; then $(CYGPATH_W) 'char_io.c'; else $(CYGPATH_W) '$(srcdir)/char_io.c'; fi`
+
+reiser4_stage1_5_exec-disk_io.o: disk_io.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(reiser4_stage1_5_exec_CFLAGS) $(CFLAGS) -MT reiser4_stage1_5_exec-disk_io.o -MD -MP -MF "$(DEPDIR)/reiser4_stage1_5_exec-disk_io.Tpo" -c -o reiser4_stage1_5_exec-disk_io.o `test -f 'disk_io.c' || echo '$(srcdir)/'`disk_io.c; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/reiser4_stage1_5_exec-disk_io.Tpo" "$(DEPDIR)/reiser4_stage1_5_exec-disk_io.Po"; else rm -f "$(DEPDIR)/reiser4_stage1_5_exec-disk_io.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='disk_io.c' object='reiser4_stage1_5_exec-disk_io.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(reiser4_stage1_5_exec_CFLAGS) $(CFLAGS) -c -o reiser4_stage1_5_exec-disk_io.o `test -f 'disk_io.c' || echo '$(srcdir)/'`disk_io.c
+
+reiser4_stage1_5_exec-disk_io.obj: disk_io.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(reiser4_stage1_5_exec_CFLAGS) $(CFLAGS) -MT reiser4_stage1_5_exec-disk_io.obj -MD -MP -MF "$(DEPDIR)/reiser4_stage1_5_exec-disk_io.Tpo" -c -o reiser4_stage1_5_exec-disk_io.obj `if test -f 'disk_io.c'; then $(CYGPATH_W) 'disk_io.c'; else $(CYGPATH_W) '$(srcdir)/disk_io.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/reiser4_stage1_5_exec-disk_io.Tpo" "$(DEPDIR)/reiser4_stage1_5_exec-disk_io.Po"; else rm -f "$(DEPDIR)/reiser4_stage1_5_exec-disk_io.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='disk_io.c' object='reiser4_stage1_5_exec-disk_io.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(reiser4_stage1_5_exec_CFLAGS) $(CFLAGS) -c -o reiser4_stage1_5_exec-disk_io.obj `if test -f 'disk_io.c'; then $(CYGPATH_W) 'disk_io.c'; else $(CYGPATH_W) '$(srcdir)/disk_io.c'; fi`
+
+reiser4_stage1_5_exec-stage1_5.o: stage1_5.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(reiser4_stage1_5_exec_CFLAGS) $(CFLAGS) -MT reiser4_stage1_5_exec-stage1_5.o -MD -MP -MF "$(DEPDIR)/reiser4_stage1_5_exec-stage1_5.Tpo" -c -o reiser4_stage1_5_exec-stage1_5.o `test -f 'stage1_5.c' || echo '$(srcdir)/'`stage1_5.c; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/reiser4_stage1_5_exec-stage1_5.Tpo" "$(DEPDIR)/reiser4_stage1_5_exec-stage1_5.Po"; else rm -f "$(DEPDIR)/reiser4_stage1_5_exec-stage1_5.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='stage1_5.c' object='reiser4_stage1_5_exec-stage1_5.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(reiser4_stage1_5_exec_CFLAGS) $(CFLAGS) -c -o reiser4_stage1_5_exec-stage1_5.o `test -f 'stage1_5.c' || echo '$(srcdir)/'`stage1_5.c
+
+reiser4_stage1_5_exec-stage1_5.obj: stage1_5.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(reiser4_stage1_5_exec_CFLAGS) $(CFLAGS) -MT reiser4_stage1_5_exec-stage1_5.obj -MD -MP -MF "$(DEPDIR)/reiser4_stage1_5_exec-stage1_5.Tpo" -c -o reiser4_stage1_5_exec-stage1_5.obj `if test -f 'stage1_5.c'; then $(CYGPATH_W) 'stage1_5.c'; else $(CYGPATH_W) '$(srcdir)/stage1_5.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/reiser4_stage1_5_exec-stage1_5.Tpo" "$(DEPDIR)/reiser4_stage1_5_exec-stage1_5.Po"; else rm -f "$(DEPDIR)/reiser4_stage1_5_exec-stage1_5.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='stage1_5.c' object='reiser4_stage1_5_exec-stage1_5.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(reiser4_stage1_5_exec_CFLAGS) $(CFLAGS) -c -o reiser4_stage1_5_exec-stage1_5.obj `if test -f 'stage1_5.c'; then $(CYGPATH_W) 'stage1_5.c'; else $(CYGPATH_W) '$(srcdir)/stage1_5.c'; fi`
+
+reiser4_stage1_5_exec-fsys_reiser4.o: fsys_reiser4.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(reiser4_stage1_5_exec_CFLAGS) $(CFLAGS) -MT reiser4_stage1_5_exec-fsys_reiser4.o -MD -MP -MF "$(DEPDIR)/reiser4_stage1_5_exec-fsys_reiser4.Tpo" -c -o reiser4_stage1_5_exec-fsys_reiser4.o `test -f 'fsys_reiser4.c' || echo '$(srcdir)/'`fsys_reiser4.c; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/reiser4_stage1_5_exec-fsys_reiser4.Tpo" "$(DEPDIR)/reiser4_stage1_5_exec-fsys_reiser4.Po"; else rm -f "$(DEPDIR)/reiser4_stage1_5_exec-fsys_reiser4.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fsys_reiser4.c' object='reiser4_stage1_5_exec-fsys_reiser4.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(reiser4_stage1_5_exec_CFLAGS) $(CFLAGS) -c -o reiser4_stage1_5_exec-fsys_reiser4.o `test -f 'fsys_reiser4.c' || echo '$(srcdir)/'`fsys_reiser4.c
+
+reiser4_stage1_5_exec-fsys_reiser4.obj: fsys_reiser4.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(reiser4_stage1_5_exec_CFLAGS) $(CFLAGS) -MT reiser4_stage1_5_exec-fsys_reiser4.obj -MD -MP -MF "$(DEPDIR)/reiser4_stage1_5_exec-fsys_reiser4.Tpo" -c -o reiser4_stage1_5_exec-fsys_reiser4.obj `if test -f 'fsys_reiser4.c'; then $(CYGPATH_W) 'fsys_reiser4.c'; else $(CYGPATH_W) '$(srcdir)/fsys_reiser4.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/reiser4_stage1_5_exec-fsys_reiser4.Tpo" "$(DEPDIR)/reiser4_stage1_5_exec-fsys_reiser4.Po"; else rm -f "$(DEPDIR)/reiser4_stage1_5_exec-fsys_reiser4.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fsys_reiser4.c' object='reiser4_stage1_5_exec-fsys_reiser4.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(reiser4_stage1_5_exec_CFLAGS) $(CFLAGS) -c -o reiser4_stage1_5_exec-fsys_reiser4.obj `if test -f 'fsys_reiser4.c'; then $(CYGPATH_W) 'fsys_reiser4.c'; else $(CYGPATH_W) '$(srcdir)/fsys_reiser4.c'; fi`
+
+reiser4_stage1_5_exec-bios.o: bios.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(reiser4_stage1_5_exec_CFLAGS) $(CFLAGS) -MT reiser4_stage1_5_exec-bios.o -MD -MP -MF "$(DEPDIR)/reiser4_stage1_5_exec-bios.Tpo" -c -o reiser4_stage1_5_exec-bios.o `test -f 'bios.c' || echo '$(srcdir)/'`bios.c; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/reiser4_stage1_5_exec-bios.Tpo" "$(DEPDIR)/reiser4_stage1_5_exec-bios.Po"; else rm -f "$(DEPDIR)/reiser4_stage1_5_exec-bios.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='bios.c' object='reiser4_stage1_5_exec-bios.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(reiser4_stage1_5_exec_CFLAGS) $(CFLAGS) -c -o reiser4_stage1_5_exec-bios.o `test -f 'bios.c' || echo '$(srcdir)/'`bios.c
+
+reiser4_stage1_5_exec-bios.obj: bios.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(reiser4_stage1_5_exec_CFLAGS) $(CFLAGS) -MT reiser4_stage1_5_exec-bios.obj -MD -MP -MF "$(DEPDIR)/reiser4_stage1_5_exec-bios.Tpo" -c -o reiser4_stage1_5_exec-bios.obj `if test -f 'bios.c'; then $(CYGPATH_W) 'bios.c'; else $(CYGPATH_W) '$(srcdir)/bios.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/reiser4_stage1_5_exec-bios.Tpo" "$(DEPDIR)/reiser4_stage1_5_exec-bios.Po"; else rm -f "$(DEPDIR)/reiser4_stage1_5_exec-bios.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='bios.c' object='reiser4_stage1_5_exec-bios.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(reiser4_stage1_5_exec_CFLAGS) $(CFLAGS) -c -o reiser4_stage1_5_exec-bios.obj `if test -f 'bios.c'; then $(CYGPATH_W) 'bios.c'; else $(CYGPATH_W) '$(srcdir)/bios.c'; fi`
+
 reiserfs_stage1_5_exec-common.o: common.c
 @am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(reiserfs_stage1_5_exec_CFLAGS) $(CFLAGS) -MT reiserfs_stage1_5_exec-common.o -MD -MP -MF "$(DEPDIR)/reiserfs_stage1_5_exec-common.Tpo" -c -o reiserfs_stage1_5_exec-common.o `test -f 'common.c' || echo '$(srcdir)/'`common.c; \
 @am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/reiserfs_stage1_5_exec-common.Tpo" "$(DEPDIR)/reiserfs_stage1_5_exec-common.Po"; else rm -f "$(DEPDIR)/reiserfs_stage1_5_exec-common.Tpo"; exit 1; fi
diff -Naur grub-0.97.orig/stage2/shared.h grub-0.97/stage2/shared.h
--- grub-0.97.orig/stage2/shared.h	2004-06-19 18:40:09.000000000 +0200
+++ grub-0.97/stage2/shared.h	2007-08-14 18:46:53.000000000 +0200
@@ -207,11 +207,12 @@
 #define STAGE2_ID_FAT_STAGE1_5		3
 #define STAGE2_ID_MINIX_STAGE1_5	4
 #define STAGE2_ID_REISERFS_STAGE1_5	5
-#define STAGE2_ID_VSTAFS_STAGE1_5	6
-#define STAGE2_ID_JFS_STAGE1_5		7
-#define STAGE2_ID_XFS_STAGE1_5		8
-#define STAGE2_ID_ISO9660_STAGE1_5	9
-#define STAGE2_ID_UFS2_STAGE1_5		10
+#define STAGE2_ID_REISER4_STAGE1_5	6
+#define STAGE2_ID_VSTAFS_STAGE1_5	7
+#define STAGE2_ID_JFS_STAGE1_5		8
+#define STAGE2_ID_XFS_STAGE1_5		9
+#define STAGE2_ID_ISO9660_STAGE1_5	10
+#define STAGE2_ID_UFS2_STAGE1_5		11
 
 #ifndef STAGE1_5
 # define STAGE2_ID	STAGE2_ID_STAGE2
@@ -226,6 +227,8 @@
 #  define STAGE2_ID	STAGE2_ID_MINIX_STAGE1_5
 # elif defined(FSYS_REISERFS)
 #  define STAGE2_ID	STAGE2_ID_REISERFS_STAGE1_5
+# elif defined(FSYS_REISER4)
+#  define STAGE2_ID	STAGE2_ID_REISER4_STAGE1_5
 # elif defined(FSYS_VSTAFS)
 #  define STAGE2_ID	STAGE2_ID_VSTAFS_STAGE1_5
 # elif defined(FSYS_JFS)
